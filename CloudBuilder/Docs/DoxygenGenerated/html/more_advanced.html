<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CloudBuilder C++ SDK: More advanced topics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xtralife-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CloudBuilder C++ SDK
   &#160;<span id="projectnumber">v3.0.0</span>
   </div>
   <div id="projectbrief">Making social games is easy !</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">More advanced topics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Using CHJSON </h1>
<p>In the <a class="el" href="namespace_cloud_builder.html">CloudBuilder</a> SDK, most of the API calls are configurable through a JSON entity called <code>CHJSON</code>, which behaves as a dictionary like a JSON object. Here is an example:</p>
<div class="fragment"><div class="line"><a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CotCHelpers::CHJSON</a> json;</div><div class="line">json.<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div><div class="line"></div><div class="line"><a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CotCHelpers::CHJSON</a> subObject;</div><div class="line">subObject.<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;hasValue&quot;</span>, <span class="keyword">true</span>);</div><div class="line">json.<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;object&quot;</span>, subObject);</div><div class="line"></div><div class="line">cstring result = json.<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#aeaf503515cde4d235104a3c642ee256f">print</a>(); <span class="comment">// Results in {&quot;key&quot;: &quot;value&quot;, &quot;object&quot;: {&quot;hasValue&quot;: true}}</span></div></div><!-- fragment --><p>To write your CHJSON objects, the following methods are recommended:</p>
<p><code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#afda1816241e8ff324994ff825c60dd7a">CotCHelpers::CHJSON::Clear()</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a1e0eefe8967a20051ced9d6d5b3f7ef5">CotCHelpers::CHJSON::Delete(const char *aItem)</a></code><br />
 <code>CHJSON* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#aef3538be445e1119c6e079e8fd35df9f">CotCHelpers::CHJSON::Duplicate() const</a></code><br />
 <code>const CHJSON* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a9617b23fdf6c3e194306b2c903f13e5d">CotCHelpers::CHJSON::Empty()</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">CotCHelpers::CHJSON::Put(const char *aKey, bool aValue)</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#aeace92b416d43776eeef11bd7910a3ef">CotCHelpers::CHJSON::Put(const char *aKey, int aValue)</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#af2317f063e4be09fbf05c8bf5df960d4">CotCHelpers::CHJSON::Put(const char *aKey, double aValue)</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ab82082633eb739e8cf7445d94d1da978">CotCHelpers::CHJSON::Put(const char *aKey, const char *aValue)</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a107ea93966507a4ae74c6870f1d5be82">CotCHelpers::CHJSON::Put(const char *aKey, CHJSON *aValue)</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#afd163298d090eaea89e3d5858ce87160">CotCHelpers::CHJSON::Put(const char *aKey, const CHJSON *aValue)</a></code><br />
 <code>void <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ade9df0ed2c0b9ee4014a7f7a4b3d01d5">CotCHelpers::CHJSON::Put(const char *aKey, const CHJSON&amp; aValue)</a></code><br />
 <code>CHJSON* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a5330daf35e0d882cdf5c85fba1ba8e3b">CotCHelpers::CHJSON::parse(const char *aJsonString)</a></code><br />
 <code>cstring <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#aeaf503515cde4d235104a3c642ee256f">CotCHelpers::CHJSON::print() const</a></code><br />
 <code>cstring <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a45fd69ef211e711ae51d6a80ce619801">CotCHelpers::CHJSON::printFormatted() const</a>;</code></p>
<p>If performance is less a concern to you or if you want to do quick prototyping, you may as well use <code>CHJSON</code> objects by reference. In that case, do not forget to delete the object when not needed anymore. Note that when putting an non-const <code>CHJSON</code> object inside another however, ownership is transferred to the new container, so you do not need to delete it yourself. This enables constructs as shown below.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_cot_c_helpers.html">CotCHelpers</a>;</div><div class="line"><a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a> *otherJson = <span class="keyword">new</span> <a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a>;</div><div class="line">otherJson-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div><div class="line"></div><div class="line"><a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a> *json = <span class="keyword">new</span> <a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a>;</div><div class="line">json-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;subObject&quot;</span>, otherJson);      <span class="comment">// ownership taken, no need to delete otherJson</span></div><div class="line"><span class="comment">// -- do not access otherJson from now, it has been rebased to json.subObject --</span></div><div class="line"></div><div class="line"><span class="comment">// Same here, the temporary object created by Parse is owned by json</span></div><div class="line">json-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;otherObj&quot;</span>, <a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a5330daf35e0d882cdf5c85fba1ba8e3b">CHJSON::parse</a>(<span class="stringliteral">&quot;{\&quot;count\&quot;: 1}&quot;</span>));</div><div class="line"></div><div class="line"><span class="keyword">const</span> <a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a> *value = json-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a2cf5a5c4ceebb917cbf64aa77475536b">Get</a>(<span class="stringliteral">&quot;subObject&quot;</span>);</div><div class="line">json-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;copy&quot;</span>, value);       <span class="comment">// copied, because the JSON is const</span></div><div class="line"></div><div class="line"><span class="comment">// Produces {&quot;subObject&quot;:{&quot;key&quot;:&quot;value&quot;},&quot;otherObj&quot;:{&quot;count&quot;:1},&quot;copy&quot;:{&quot;key&quot;:&quot;value&quot;}}</span></div><div class="line"><span class="keyword">delete</span> json;</div></div><!-- fragment --><h1><a class="anchor" id="pretty_print_json"></a>
Printing JSON</h1>
<p>Since version 3.00, (pretty-)printing JSONs use the <a class="el" href="struct_cot_c_helpers_1_1cstring.html">CotCHelpers::cstring</a> API, which encapsulates an immutable string. Note that copying a cstring also copies the associated string, so the performance is worse than using raw char* pointers. If you need more performance, you can use the cstring&amp; print(cstring&amp; dest) counterpart, which directly modifies the cstring object to contain the string made from printing the JSON object and release it at the end. Assigning a value to a cstring is done via the <code>&lt;&lt;=</code> operator and involves no copy, just taking ownership of the string.</p>
<div class="fragment"><div class="line">{</div><div class="line">    <span class="keywordtype">char</span>* freeableString = strdup(<span class="stringliteral">&quot;hello world&quot;</span>);</div><div class="line">    cstring mystring;</div><div class="line">    mystring &lt;&lt;= freeableString; <span class="comment">// or cstring mystring(freeableString, true);</span></div><div class="line">}</div><div class="line"><span class="comment">// freeableString is now freed as a result of mystring becoming out of scope.</span></div><div class="line"></div><div class="line">cstring myfunc() {</div><div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;object&quot;</span>; <span class="comment">// Creates a cstring object, copies the litteral and keeps a pointer</span></div><div class="line">}</div><div class="line"><span class="comment">// Copies the string again in result, frees the pointer that was created in the function</span></div><div class="line">cstring result = myfunc();</div></div><!-- fragment --><h2>Arrays </h2>
<p>Arrays should not be needed, but you can create them like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_cot_c_helpers.html">CotCHelpers</a>;</div><div class="line"><a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a> *array = <a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#af24d7b9021069ca2935f58fef85268dd">CHJSON::Array</a>();</div><div class="line"><a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a> *objEntry = <span class="keyword">new</span> <a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a>;</div><div class="line"><a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a> *numericEntry = <span class="keyword">new</span> <a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html">CHJSON</a>(12.0);</div><div class="line">objEntry-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a4e82d022dfb462ff570458aa6fc5676d">Put</a>(<span class="stringliteral">&quot;key&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);</div><div class="line">array-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a97af1061ea6360d3e2a43b40f7a11a96">Add</a>(objEntry);</div><div class="line">array-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a97af1061ea6360d3e2a43b40f7a11a96">Add</a>(numericEntry);</div><div class="line"><span class="comment">// Produces [{&quot;key&quot;: &quot;value&quot;}, 12]</span></div><div class="line"><span class="keyword">delete</span> array;</div></div><!-- fragment --><h2>Reading from CHJSON </h2>
<p><code>CHJSON</code> objects are also used when returning a value from the SDK. Most of the calls take a callback (<a class="el" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CloudBuilder::CResultHandler</a>) which has the following form.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyGame::ResultHandler(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result) {</div><div class="line">    <span class="keyword">const</span> CHJSON *json = result-&gt;GetJSON();</div><div class="line">}</div></div><!-- fragment --><p>This object is guaranteed never <code>NULL</code> (at worst it is empty). You can read from <code>CHJSON</code> objects in a safe and compact way using this recommended set of methods.</p>
<p><code>bool <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a501e9374fdf75a5023e98fa2b831db7f">CotCHelpers::CHJSON::Has(const char *key) const</a></code><br />
 <code>const CHJSON* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a2cf5a5c4ceebb917cbf64aa77475536b">CotCHelpers::CHJSON::Get(int aIndex) const</a></code><br />
 <code>const CHJSON* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a6c3298bd61cf56c24ce0c77a050b3c17">CotCHelpers::CHJSON::Get(const char *aItem) const</a></code><br />
 <code>const CHJSON* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ae38d16dcc527c3ee399735913098acee">CotCHelpers::CHJSON::GetSafe(int aIndex) const</a></code><br />
 <code>const CHJSON* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#aface48a38f3d55c446efb990d986a03b">CotCHelpers::CHJSON::GetSafe(const char *aItem) const</a></code><br />
 <code>double <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#aa2cd5fc5b1b7257edd5346f6e441b681">CotCHelpers::CHJSON::GetDouble(const char *aItem, double defaultValue) const</a></code><br />
 <code>int <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ab18b4613d850867b859d47dca3aa6daa">CotCHelpers::CHJSON::GetInt(const char *aItem, int defaultValue) const</a></code><br />
 <code>bool <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#aa3510c65585a98d3332fde15fb88f390">CotCHelpers::CHJSON::GetBool(const char *aItem, bool defaultValue) const</a></code><br />
 <code>const char* <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a13ab5512390ba71a335365c16e6a8dda">CotCHelpers::CHJSON::GetString(const char *key, const char *defaultValue) const</a></code><br />
 <code>Iterator <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a0be09e439914258672e2623daa9b5dbf">CotCHelpers::CHJSON::begin() const</a></code><br />
 <code>Iterator <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ab0c7d403d474335df4f0e5df8f00b65b">CotCHelpers::CHJSON::end() const</a></code><br />
 <code>int <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a59de558294063d07fa7dc81544a4a47d">CotCHelpers::CHJSON::size() const</a></code><br />
</p>
<p>If you expect to have an object such as {"obj": {"value": 123}} then you can safely do the following.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyGame::ResultHandler(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result) {</div><div class="line">    <span class="keyword">const</span> CHJSON *json = result-&gt;GetJSON();</div><div class="line">    <span class="keywordtype">int</span> value = json-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ae38d16dcc527c3ee399735913098acee">GetSafe</a>(<span class="stringliteral">&quot;obj&quot;</span>)-&gt;<a class="code" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ab18b4613d850867b859d47dca3aa6daa">GetInt</a>(<span class="stringliteral">&quot;value&quot;</span>);</div><div class="line">    <span class="comment">// Value will be either 0 (either json is empty, obj doesn&#39;t exist or value doesn&#39;t exist) either the desired value</span></div><div class="line">}</div></div><!-- fragment --><p>It will work because all <code>Get*</code> methods (except <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a2cf5a5c4ceebb917cbf64aa77475536b">CotCHelpers::CHJSON::Get</a> itself which might return <code>NULL</code>) will safely handle the fact that the desired object does not exist and return a default value. In the case of <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#ae38d16dcc527c3ee399735913098acee">CotCHelpers::CHJSON::GetSafe</a> it is simply an empty object (see <a class="el" href="class_cot_c_helpers_1_1_c_h_j_s_o_n.html#a9617b23fdf6c3e194306b2c903f13e5d">CotCHelpers::CHJSON::Empty</a>) so you may transitively query for additional keys within the hierarchy without worrying.</p>
<p>Optionally, you can also pass a default value to the <code>Get*</code> methods, which will be returned in case the element is not found.</p>
<p>Listing the sub-nodes ("values") of a <code>CHJSON</code> can be done easily using the provided iterator.</p>
<div class="fragment"><div class="line">CHJSON *<span class="keywordtype">object</span> = <span class="keyword">new</span> CHJSON;</div><div class="line"><span class="keywordtype">object</span>-&gt;Put(<span class="stringliteral">&quot;key1&quot;</span>, <span class="stringliteral">&quot;value1&quot;</span>);</div><div class="line"><span class="keywordtype">object</span>-&gt;Put(<span class="stringliteral">&quot;key2&quot;</span>, <span class="stringliteral">&quot;value2&quot;</span>);</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> CHJSON *node: *<span class="keywordtype">object</span>) {</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *key = node-&gt;name();</div><div class="line">    printf(<span class="stringliteral">&quot;Key: %s, value: %s\n&quot;</span>, key, object-&gt;GetString(key));</div><div class="line">}</div><div class="line"><span class="keyword">delete</span> object;</div></div><!-- fragment --><p>This can be done for arrays as well, but nodes obviously won't have a name. This snippet is provided here for reference:</p>
<div class="fragment"><div class="line">CHJSON *array = CHJSON::Array();</div><div class="line">array-&gt;Add(<span class="keyword">new</span> CHJSON(123));</div><div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> CHJSON *node: *array) {</div><div class="line">    <span class="keywordflow">if</span> (node-&gt;type() == CHJSON::jsonNumber)</div><div class="line">        printf(<span class="stringliteral">&quot;Got a number: %d&quot;</span>, node-&gt;valueInt());</div><div class="line">}</div></div><!-- fragment --><h1>Using callbacks (CResultHandler) </h1>
<p>The <a class="el" href="namespace_cloud_builder.html">CloudBuilder</a> SDK uses a strongly asynchronous programming model, with callbacks and listeners in many places to process data coming from the network. To achieve that, the model relies on a class named <code>CDelegate</code>, which basically allows to pass a pointer to a method with a given signature to be executed later when the arguments have become available. For reference, here is a sample of game requiring you to guess a number, with the method to check being passed as argument:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyGame {</div><div class="line">    <span class="keywordtype">void</span> Main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div><div class="line">        <span class="comment">// We&#39;ll accept the inputted number if it is odd, easy enough!</span></div><div class="line">        Play(MakeDelegate(<span class="keyword">this</span>, &amp;MyGame::IsOdd));</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> Play(CDelegate&lt;<span class="keywordtype">bool</span> (<span class="keywordtype">int</span>)&gt; *checkFunc) {</div><div class="line">        <span class="keywordtype">int</span> inputtedNumber;</div><div class="line">        <span class="keywordflow">do</span> {</div><div class="line">            printf(<span class="stringliteral">&quot;Input a number: &quot;</span>);</div><div class="line">            scanf(<span class="stringliteral">&quot;%d&quot;</span>, &amp;inputtedNumber);</div><div class="line">        } <span class="keywordflow">while</span> (!checkFunc-&gt;Invoke(inputtedNumber));</div><div class="line">        <span class="keyword">delete</span> checkFunc;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> IsOdd(<span class="keywordtype">int</span> number) {</div><div class="line">        <span class="keywordflow">return</span> number % 2 == 0;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>The same principle is used with <code>CResultHandler</code>, which is actually just a kind of <code>CDelegate</code> with standard arguments. Usually, you will want to create result handlers by using the provided MakeResultHandler method:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyGame::OnSetup(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result);</div><div class="line"></div><div class="line">CClan::Instance()-&gt;Setup(&amp;json, <a class="code" href="namespace_cloud_builder.html#a0b1b22f20ce072961d4674a3fbc20559">MakeResultHandler</a>(<span class="keyword">this</span>, &amp;MyGame::OnSetup));</div></div><!-- fragment --><p>It will create the appropriate type of delegate using genericity, and the Setup method will not accept it if the type differ, meaning that you will have to fix the signature of your OnSetup method to match the expected one.</p>
<h2>Passing parameters </h2>
<p>The <code>MakeResultHandler</code> allows you to pass additional parameters, which will be forwarded to your method as additional arguments trailing the default ones. An example is shown below.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyGame::OnSetup(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result, <span class="keywordtype">int</span> additionalInt, <span class="keywordtype">char</span> *additionalStr) {</div><div class="line">    printf(<span class="stringliteral">&quot;Got %d and %s\n&quot;</span>, additionalInt, additionalStr);</div><div class="line">    free(additionalStr);</div><div class="line">}</div><div class="line"></div><div class="line">CClan::Instance()-&gt;Setup(&amp;json, <a class="code" href="namespace_cloud_builder.html#a0b1b22f20ce072961d4674a3fbc20559">MakeResultHandler</a>(<span class="keyword">this</span>, &amp;MyGame::OnSetup, 123, strdup(<span class="stringliteral">&quot;hello&quot;</span>)));</div></div><!-- fragment --><p>You can pass up to 3 parameters of any type, even a struct if you like. However, on a performance point of view, keep in mind that the parameters may be copied multiple times around, so it is peferrable to use either small and simple structures or pass a pointer. Also note that if you pass a pointer to something, it has to remain valid until the callback is called, so you will probably want to duplicate the object and delete it inside the callback as shown above with the strdup/free combo.</p>
<h2>Custom delegates </h2>
<p>Using polymorphism, it is also possible to make fully custom callbacks, which just have to respond to the specification of a <code>CDelegate</code> (that is, basically to provide an object/method combo corresponding to the signature, to be invoked). Anonymous structures come in handy for this task:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>SetupHandler: <a class="code" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CResultHandler</a> {</div><div class="line">    SetupHandler() : <a class="code" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CResultHandler</a>(this, &amp;SetupHandler::Done) {}</div><div class="line">    </div><div class="line">    <span class="keywordtype">void</span> Done(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result) {</div><div class="line">        <span class="comment">// Inline (&quot;lambda&quot;-style) processing</span></div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line">CClan::Instance()-&gt;Setup(&amp;json, <span class="keyword">new</span> SetupHandler);</div></div><!-- fragment --><p>The only problem here is that your anonymous structure doesn't have access to the enclosed members. You need to capture them manually, as shown below for the <code>this</code> pointer.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyGame {</div><div class="line">    </div><div class="line">    <span class="keywordtype">void</span> Main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div><div class="line">        <span class="keyword">struct </span>SetupHandler: <a class="code" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CResultHandler</a> {</div><div class="line">            MyGame *<span class="keyword">self</span>;</div><div class="line">            SetupHandler(MyGame *<span class="keyword">self</span>) : self(self), <a class="code" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CResultHandler</a>(this, &amp;SetupHandler::Done) {}</div><div class="line">            <span class="keywordtype">void</span> Done(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result) {</div><div class="line">                <span class="comment">// Inline (&quot;lambda&quot;-style) processing</span></div><div class="line">                <span class="keyword">self</span>-&gt;SetupOkay();</div><div class="line">            }</div><div class="line">        };</div><div class="line"></div><div class="line">        CClan::Instance()-&gt;Setup(&amp;json, <span class="keyword">new</span> SetupHandler(<span class="keyword">this</span>));</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordtype">void</span> SetupOkay() {</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>However, now that you know the inners of these delegates, you can forward the original call anywhere you like. You may for instance forward the call to a C++11 lambda as shown below, enabling for very nice constructs.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;functional&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> std::function&lt;void(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a>, <span class="keyword">const</span> CCloudResult*)&gt; resultHandler_t;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CResultHandler</a> *<a class="code" href="namespace_cloud_builder.html#a0b1b22f20ce072961d4674a3fbc20559">MakeResultHandler</a>(resultHandler_t func) {</div><div class="line">    <span class="keyword">struct </span>FunctionalResultHandler: <a class="code" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CResultHandler</a> {</div><div class="line">        resultHandler_t func;</div><div class="line">        FunctionalResultHandler(resultHandler_t func) : func(func), <a class="code" href="namespace_cloud_builder.html#aa9298038517f1c9498ac65a0fef1ff93">CResultHandler</a>(this, &amp;FunctionalResultHandler::Done) {}</div><div class="line">        <span class="keywordtype">void</span> Done(<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result) {</div><div class="line">            func(code, result);</div><div class="line">        }</div><div class="line">    };</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> FunctionalResultHandler(func);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">struct </span>MyGame {</div><div class="line">    </div><div class="line">    <span class="keywordtype">void</span> Main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {</div><div class="line">    </div><div class="line">        CClan::Instance()-&gt;Setup(&amp;json, <a class="code" href="namespace_cloud_builder.html#a0b1b22f20ce072961d4674a3fbc20559">MakeResultHandler</a>([=] (<a class="code" href="namespace_cloud_builder.html#ab5524f4b2296da386bc5d0ec8e103c27">eErrorCode</a> code, <span class="keyword">const</span> CCloudResult *result) {</div><div class="line">            this-&gt;SetupOkay();</div><div class="line">        }));</div><div class="line">    }</div><div class="line">    </div><div class="line">    <span class="keywordtype">void</span> SetupOkay() {</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p>If you are using Visual C++ 2010, beware that there is a bug preventing nested lambdas from capturing the same member in this version. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 7 2019 16:30:55 for CloudBuilder C++ SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
